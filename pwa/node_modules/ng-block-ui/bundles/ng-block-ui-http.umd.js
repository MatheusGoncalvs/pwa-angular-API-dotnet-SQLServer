(function (global, factory) {
    typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, require('@angular/core'), require('rxjs/operators'), require('ng-block-ui'), require('@angular/common/http')) :
    typeof define === 'function' && define.amd ? define('ng-block-ui/http', ['exports', '@angular/core', 'rxjs/operators', 'ng-block-ui', '@angular/common/http'], factory) :
    (factory((global['ng-block-ui'] = global['ng-block-ui'] || {}, global['ng-block-ui'].http = {}),global.ng.core,global.rxjs.operators,global['ng-block-ui'],global.ng.common.http));
}(this, (function (exports,core,operators,ngBlockUi,http) { 'use strict';

    /**
     * @fileoverview added by tsickle
     * @suppress {checkTypes} checked by tsc
     */
    var BlockUIHttpSettings = (function () {
        function BlockUIHttpSettings() {
            this.settings = {};
        }
        BlockUIHttpSettings.decorators = [
            { type: core.Injectable },
        ];
        return BlockUIHttpSettings;
    }());

    /**
     * @fileoverview added by tsickle
     * @suppress {checkTypes} checked by tsc
     */
    var BlockUIInterceptor = (function () {
        function BlockUIInterceptor(blockUIService, blockUIHttpSettings) {
            this.blockUIService = blockUIService;
            this.blockUIHttpSettings = blockUIHttpSettings;
            this.activeHttpRequests = 0;
        }
        /**
         * @param {?} request
         * @param {?} next
         * @return {?}
         */
        BlockUIInterceptor.prototype.intercept = /**
         * @param {?} request
         * @param {?} next
         * @return {?}
         */
            function (request, next) {
                var _this = this;
                var /** @type {?} */ active = false;
                if (this.shouldBlock(request)) {
                    active = true;
                    this.activeHttpRequests++;
                    this.blockUIService.start(ngBlockUi.BLOCKUI_DEFAULT);
                }
                return next.handle(request)
                    .pipe(operators.finalize(function () {
                    if (_this.shouldBlock(request)) {
                        _this.activeHttpRequests--;
                        var blockAllRequestsInProgress = _this.blockUIHttpSettings.settings.blockAllRequestsInProgress;
                        var /** @type {?} */ stopBlockUI = false;
                        if (!!blockAllRequestsInProgress && _this.activeHttpRequests <= 0) {
                            _this.activeHttpRequests = 0;
                            stopBlockUI = true;
                        }
                        else if (active) {
                            stopBlockUI = true;
                        }
                        if (stopBlockUI) {
                            var /** @type {?} */ method = blockAllRequestsInProgress ? 'stop' : 'reset';
                            _this.blockUIService[method](ngBlockUi.BLOCKUI_DEFAULT);
                        }
                    }
                }));
            };
        /**
         * @param {?} request
         * @return {?}
         */
        BlockUIInterceptor.prototype.shouldBlock = /**
         * @param {?} request
         * @return {?}
         */
            function (request) {
                var method = request.method, urlWithParams = request.urlWithParams;
                var settings = this.blockUIHttpSettings.settings;
                var /** @type {?} */ requestFilters = settings.requestFilters || [];
                return !requestFilters.some(function (f) {
                    if (f && f.method && f.url) {
                        return f.method.toUpperCase() === method && f.url.test(urlWithParams);
                    }
                    else if (typeof f === 'function') {
                        return f(request);
                    }
                    return f.test(urlWithParams);
                });
            };
        BlockUIInterceptor.decorators = [
            { type: core.Injectable },
        ];
        /** @nocollapse */
        BlockUIInterceptor.ctorParameters = function () {
            return [
                { type: ngBlockUi.BlockUIService },
                { type: BlockUIHttpSettings }
            ];
        };
        return BlockUIInterceptor;
    }());

    /**
     * @fileoverview added by tsickle
     * @suppress {checkTypes} checked by tsc
     */
    // Needed for AOT compiling
    var /** @type {?} */ BlockUIHttpModuleSettings = new core.InjectionToken('BlockUIHttpModuleSettings');
    /**
     * @param {?} settings
     * @return {?}
     */
    function provideSettingsInstance(settings) {
        return { settings: settings };
    }
    var BlockUIHttpModule = (function () {
        function BlockUIHttpModule() {
        }
        /**
         * @param {?=} settings
         * @return {?}
         */
        BlockUIHttpModule.forRoot = /**
         * @param {?=} settings
         * @return {?}
         */
            function (settings) {
                if (settings === void 0) {
                    settings = {};
                }
                return {
                    ngModule: BlockUIHttpModule,
                    providers: [
                        {
                            provide: BlockUIHttpModuleSettings,
                            useValue: settings
                        },
                        {
                            provide: BlockUIHttpSettings,
                            useFactory: provideSettingsInstance,
                            deps: [BlockUIHttpModuleSettings]
                        },
                        {
                            provide: http.HTTP_INTERCEPTORS,
                            useClass: BlockUIInterceptor,
                            multi: true
                        }
                    ]
                };
            };
        BlockUIHttpModule.decorators = [
            { type: core.NgModule, args: [{
                        imports: [ngBlockUi.BlockUIModule]
                    },] },
        ];
        return BlockUIHttpModule;
    }());

    /**
     * @fileoverview added by tsickle
     * @suppress {checkTypes} checked by tsc
     */

    /**
     * @fileoverview added by tsickle
     * @suppress {checkTypes} checked by tsc
     */

    exports.BlockUIHttpModule = BlockUIHttpModule;
    exports.ɵc = BlockUIHttpSettings;
    exports.ɵd = BlockUIInterceptor;
    exports.ɵa = BlockUIHttpModuleSettings;
    exports.ɵb = provideSettingsInstance;

    Object.defineProperty(exports, '__esModule', { value: true });

})));

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmctYmxvY2stdWktaHR0cC51bWQuanMubWFwIiwic291cmNlcyI6WyJuZzovL25nLWJsb2NrLXVpL2h0dHAvYmxvY2stdWktaHR0cC1zZXR0aW5ncy5zZXJ2aWNlLnRzIiwibmc6Ly9uZy1ibG9jay11aS9odHRwL2Jsb2NrLXVpLWh0dHAuaW50ZXJjZXB0b3IudHMiLCJuZzovL25nLWJsb2NrLXVpL2h0dHAvYmxvY2stdWktaHR0cC5tb2R1bGUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgSHR0cFNldHRpbmdzIH0gZnJvbSAnbmctYmxvY2stdWknO1xuXG5ASW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgQmxvY2tVSUh0dHBTZXR0aW5ncyB7XG4gIHNldHRpbmdzOiBIdHRwU2V0dGluZ3MgPSB7fTtcbn1cbiIsImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7XG4gIEh0dHBSZXF1ZXN0LFxuICBIdHRwSGFuZGxlcixcbiAgSHR0cEV2ZW50LFxuICBIdHRwSW50ZXJjZXB0b3Jcbn0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgZmluYWxpemUgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBCbG9ja1VJU2VydmljZSwgQkxPQ0tVSV9ERUZBVUxUIH0gZnJvbSAnbmctYmxvY2stdWknO1xuaW1wb3J0IHsgQmxvY2tVSUh0dHBTZXR0aW5ncyB9IGZyb20gJy4vYmxvY2stdWktaHR0cC1zZXR0aW5ncy5zZXJ2aWNlJztcblxuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIEJsb2NrVUlJbnRlcmNlcHRvciBpbXBsZW1lbnRzIEh0dHBJbnRlcmNlcHRvciB7XG4gIHByaXZhdGUgYWN0aXZlSHR0cFJlcXVlc3RzOiBudW1iZXI7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBibG9ja1VJU2VydmljZTogQmxvY2tVSVNlcnZpY2UsXG4gICAgcHJpdmF0ZSBibG9ja1VJSHR0cFNldHRpbmdzOiBCbG9ja1VJSHR0cFNldHRpbmdzXG4gICkge1xuICAgIHRoaXMuYWN0aXZlSHR0cFJlcXVlc3RzID0gMDtcbiAgfVxuXG4gIGludGVyY2VwdChyZXF1ZXN0OiBIdHRwUmVxdWVzdDxhbnk+LCBuZXh0OiBIdHRwSGFuZGxlcik6IE9ic2VydmFibGU8SHR0cEV2ZW50PGFueT4+IHtcbiAgICBsZXQgYWN0aXZlOiBib29sZWFuID0gZmFsc2U7XG5cbiAgICBpZiAodGhpcy5zaG91bGRCbG9jayhyZXF1ZXN0KSkge1xuICAgICAgYWN0aXZlID0gdHJ1ZTtcbiAgICAgIHRoaXMuYWN0aXZlSHR0cFJlcXVlc3RzKys7XG4gICAgICB0aGlzLmJsb2NrVUlTZXJ2aWNlLnN0YXJ0KEJMT0NLVUlfREVGQVVMVCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIG5leHQuaGFuZGxlKHJlcXVlc3QpXG4gICAgICAucGlwZShcbiAgICAgICAgZmluYWxpemUoKCkgPT4ge1xuICAgICAgICAgIGlmICh0aGlzLnNob3VsZEJsb2NrKHJlcXVlc3QpKSB7XG4gICAgICAgICAgICB0aGlzLmFjdGl2ZUh0dHBSZXF1ZXN0cy0tO1xuICAgICAgICAgICAgY29uc3QgeyBibG9ja0FsbFJlcXVlc3RzSW5Qcm9ncmVzcyB9ID0gdGhpcy5ibG9ja1VJSHR0cFNldHRpbmdzLnNldHRpbmdzO1xuICAgICAgICAgICAgbGV0IHN0b3BCbG9ja1VJOiBib29sZWFuID0gZmFsc2U7XG5cbiAgICAgICAgICAgIGlmICghIWJsb2NrQWxsUmVxdWVzdHNJblByb2dyZXNzICYmIHRoaXMuYWN0aXZlSHR0cFJlcXVlc3RzIDw9IDApIHtcbiAgICAgICAgICAgICAgdGhpcy5hY3RpdmVIdHRwUmVxdWVzdHMgPSAwO1xuICAgICAgICAgICAgICBzdG9wQmxvY2tVSSA9IHRydWU7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGFjdGl2ZSkge1xuICAgICAgICAgICAgICBzdG9wQmxvY2tVSSA9IHRydWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChzdG9wQmxvY2tVSSkge1xuICAgICAgICAgICAgICBjb25zdCBtZXRob2Q6IHN0cmluZyA9IGJsb2NrQWxsUmVxdWVzdHNJblByb2dyZXNzID8gJ3N0b3AnIDogJ3Jlc2V0JztcbiAgICAgICAgICAgICAgdGhpcy5ibG9ja1VJU2VydmljZVttZXRob2RdKEJMT0NLVUlfREVGQVVMVCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9KVxuICAgICAgKTtcbiAgfVxuXG4gIHNob3VsZEJsb2NrKHJlcXVlc3Q6IEh0dHBSZXF1ZXN0PGFueT4pOiBib29sZWFuIHtcbiAgICBjb25zdCB7IG1ldGhvZCwgdXJsV2l0aFBhcmFtcyB9ID0gcmVxdWVzdDtcbiAgICBjb25zdCB7IHNldHRpbmdzIH0gPSB0aGlzLmJsb2NrVUlIdHRwU2V0dGluZ3M7XG4gICAgY29uc3QgcmVxdWVzdEZpbHRlcnMgPSBzZXR0aW5ncy5yZXF1ZXN0RmlsdGVycyB8fCBbXTtcblxuICAgIHJldHVybiAhcmVxdWVzdEZpbHRlcnMuc29tZSgoZjogYW55KSA9PiB7XG4gICAgICBpZiAoZiAmJiBmLm1ldGhvZCAmJiBmLnVybCkge1xuICAgICAgICByZXR1cm4gZi5tZXRob2QudG9VcHBlckNhc2UoKSA9PT0gbWV0aG9kICYmIGYudXJsLnRlc3QodXJsV2l0aFBhcmFtcyk7XG4gICAgICB9IGVsc2UgaWYgKHR5cGVvZiBmID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIHJldHVybiBmKHJlcXVlc3QpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gZi50ZXN0KHVybFdpdGhQYXJhbXMpO1xuICAgIH0pO1xuICB9XG59XG4iLCJpbXBvcnQgeyBOZ01vZHVsZSwgTW9kdWxlV2l0aFByb3ZpZGVycywgSW5qZWN0aW9uVG9rZW4gfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEhUVFBfSU5URVJDRVBUT1JTIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xuaW1wb3J0IHsgQmxvY2tVSU1vZHVsZSwgSHR0cFNldHRpbmdzIH0gZnJvbSAnbmctYmxvY2stdWknO1xuaW1wb3J0IHsgQmxvY2tVSUh0dHBTZXR0aW5ncyB9IGZyb20gJy4vYmxvY2stdWktaHR0cC1zZXR0aW5ncy5zZXJ2aWNlJztcbmltcG9ydCB7IEJsb2NrVUlJbnRlcmNlcHRvciB9IGZyb20gJy4vYmxvY2stdWktaHR0cC5pbnRlcmNlcHRvcic7XG5cblxuLy8gTmVlZGVkIGZvciBBT1QgY29tcGlsaW5nXG5leHBvcnQgY29uc3QgQmxvY2tVSUh0dHBNb2R1bGVTZXR0aW5ncyA9IG5ldyBJbmplY3Rpb25Ub2tlbjxzdHJpbmc+KCdCbG9ja1VJSHR0cE1vZHVsZVNldHRpbmdzJyk7XG5cbmV4cG9ydCBmdW5jdGlvbiBwcm92aWRlU2V0dGluZ3NJbnN0YW5jZShzZXR0aW5nczogSHR0cFNldHRpbmdzKTogQmxvY2tVSUh0dHBTZXR0aW5ncyB7XG4gIHJldHVybiB7IHNldHRpbmdzIH07XG59XG5cbkBOZ01vZHVsZSh7XG4gIGltcG9ydHM6IFtCbG9ja1VJTW9kdWxlXVxufSlcbmV4cG9ydCBjbGFzcyBCbG9ja1VJSHR0cE1vZHVsZSB7XG4gIHB1YmxpYyBzdGF0aWMgZm9yUm9vdChzZXR0aW5nczogSHR0cFNldHRpbmdzID0ge30pOiBNb2R1bGVXaXRoUHJvdmlkZXJzIHtcbiAgICByZXR1cm4ge1xuICAgICAgbmdNb2R1bGU6IEJsb2NrVUlIdHRwTW9kdWxlLFxuICAgICAgcHJvdmlkZXJzOiBbXG4gICAgICAgIHtcbiAgICAgICAgICBwcm92aWRlOiBCbG9ja1VJSHR0cE1vZHVsZVNldHRpbmdzLFxuICAgICAgICAgIHVzZVZhbHVlOiBzZXR0aW5nc1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgcHJvdmlkZTogQmxvY2tVSUh0dHBTZXR0aW5ncyxcbiAgICAgICAgICB1c2VGYWN0b3J5OiBwcm92aWRlU2V0dGluZ3NJbnN0YW5jZSxcbiAgICAgICAgICBkZXBzOiBbQmxvY2tVSUh0dHBNb2R1bGVTZXR0aW5nc11cbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIHByb3ZpZGU6IEhUVFBfSU5URVJDRVBUT1JTLFxuICAgICAgICAgIHVzZUNsYXNzOiBCbG9ja1VJSW50ZXJjZXB0b3IsXG4gICAgICAgICAgbXVsdGk6IHRydWVcbiAgICAgICAgfVxuICAgICAgXVxuICAgIH07XG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJJbmplY3RhYmxlIiwiQkxPQ0tVSV9ERUZBVUxUIiwiZmluYWxpemUiLCJCbG9ja1VJU2VydmljZSIsIkluamVjdGlvblRva2VuIiwiSFRUUF9JTlRFUkNFUFRPUlMiLCJOZ01vZHVsZSIsIkJsb2NrVUlNb2R1bGUiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFBQTs7NEJBSzJCLEVBQUU7OztvQkFGNUJBLGVBQVU7O2tDQUhYOzs7Ozs7O0FDQUE7UUFnQkUsNEJBQ1UsZ0JBQ0E7WUFEQSxtQkFBYyxHQUFkLGNBQWM7WUFDZCx3QkFBbUIsR0FBbkIsbUJBQW1CO1lBRTNCLElBQUksQ0FBQyxrQkFBa0IsR0FBRyxDQUFDLENBQUM7U0FDN0I7Ozs7OztRQUVELHNDQUFTOzs7OztZQUFULFVBQVUsT0FBeUIsRUFBRSxJQUFpQjtnQkFBdEQsaUJBK0JDO2dCQTlCQyxxQkFBSSxNQUFNLEdBQVksS0FBSyxDQUFDO2dCQUU1QixJQUFJLElBQUksQ0FBQyxXQUFXLENBQUMsT0FBTyxDQUFDLEVBQUU7b0JBQzdCLE1BQU0sR0FBRyxJQUFJLENBQUM7b0JBQ2QsSUFBSSxDQUFDLGtCQUFrQixFQUFFLENBQUM7b0JBQzFCLElBQUksQ0FBQyxjQUFjLENBQUMsS0FBSyxDQUFDQyx5QkFBZSxDQUFDLENBQUM7aUJBQzVDO2dCQUVELE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUM7cUJBQ3hCLElBQUks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